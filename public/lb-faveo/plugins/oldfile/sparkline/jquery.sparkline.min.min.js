(function(e,d,f){(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(jQuery&&!jQuery.fn.sparkline){a(jQuery)}}}(function(aj){var Z={},af,R,V,W,T,ah,O,N,P,ap,ao,c,ae,ag,X,S,ab,al,aa,Y,an,ar,U,Q,ad,a,aq,b,ai,ac,M,ak,am=0;af=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:false,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:false,enableHighlight:true,highlightLighten:1.4,tooltipSkipNull:true,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:false,numberFormatter:false,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:false,disableInteraction:false},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:f,normalRangeMax:f,normalRangeColor:"#ccc",drawNormalOnTop:false,chartRangeMin:f,chartRangeMax:f,chartRangeMinX:f,chartRangeMaxX:f,tooltipFormat:new V('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:f,nullColor:f,zeroAxis:true,barWidth:4,barSpacing:1,chartRangeMax:f,chartRangeMin:f,chartRangeClip:false,colorMap:f,tooltipFormat:new V('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new V('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss","0":"Draw","1":"Win"}}},discrete:{lineHeight:"auto",thresholdColor:f,thresholdValue:0,chartRangeMax:f,chartRangeMin:f,chartRangeClip:false,tooltipFormat:new V("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:f,tooltipFormat:new V("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new V('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:false,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:true,outlierIQR:1.5,spotRadius:1.5,target:f,targetColor:"#4a2",chartRangeMax:f,chartRangeMin:f,tooltipFormat:new V("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}};a='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}';R=function(){var h,g;h=function(){this.init.apply(this,arguments)};if(arguments.length>1){if(arguments[0]){h.prototype=aj.extend(new arguments[0](),arguments[arguments.length-1]);h._super=arguments[0].prototype}else{h.prototype=arguments[arguments.length-1]}if(arguments.length>2){g=Array.prototype.slice.call(arguments,1,-1);g.unshift(h.prototype);aj.extend.apply(aj,g)}}else{h.prototype=arguments[0]}h.prototype.cls=h;return h};aj.SPFormatClass=V=R({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(g,h){this.format=g;this.fclass=h},render:function(h,j,g){var i=this,k=h,l,o,n,m,p;return this.format.replace(this.fre,function(){var q;o=arguments[1];n=arguments[3];l=i.precre.exec(o);if(l){p=l[2];o=l[1]}else{p=false}m=k[o];if(m===f){return""}if(n&&j&&j[n]){q=j[n];if(q.get){return j[n].get(m)||m}else{return j[n][m]||m}}if(P(m)){if(g.get("numberFormatter")){m=g.get("numberFormatter")(m)}else{m=ag(m,p,g.get("numberDigitGroupCount"),g.get("numberDigitGroupSep"),g.get("numberDecimalMark"))}}return m})}});aj.spformat=function(g,h){return new V(g,h)};W=function(g,h,i){if(g<h){return h}if(g>i){return i}return g};T=function(i,g){var h;if(g===2){h=d.floor(i.length/2);return i.length%2?i[h]:(i[h-1]+i[h])/2}else{if(i.length%2){h=(i.length*g+g)/4;return h%1?(i[d.floor(h)]+i[d.floor(h)-1])/2:i[h-1]}else{h=(i.length*g+2)/4;return h%1?(i[d.floor(h)]+i[d.floor(h)-1])/2:i[h-1]}}};ah=function(g){var h;switch(g){case"undefined":g=f;break;case"null":g=null;break;case"true":g=true;break;case"false":g=false;break;default:h=parseFloat(g);if(g==h){g=h}}return g};O=function(g){var h,i=[];for(h=g.length;h--;){i[h]=ah(g[h])}return i};N=function(g,i){var j,h,k=[];for(j=0,h=g.length;j<h;j++){if(g[j]!==i){k.push(g[j])}}return k};P=function(g){return !isNaN(parseFloat(g))&&isFinite(g)};ag=function(k,l,m,h,i){var g,j;k=(l===false?parseFloat(k).toString():k.toFixed(l)).split("");g=(g=aj.inArray(".",k))<0?k.length:g;if(g<k.length){k[g]=i}for(j=g-m;j>0;j-=m){k.splice(j,0,h)}return k.join("")};ap=function(g,i,j){var h;for(h=i.length;h--;){if(j&&i[h]===null){continue}if(i[h]!==g){return false}}return true};ao=function(g){var h=0,i;for(i=g.length;i--;){h+=typeof g[i]==="number"?g[i]:0}return h};ae=function(g){return aj.isArray(g)?g:[g]};c=function(g){var h;if(e.createStyleSheet){e.createStyleSheet().cssText=g}else{h=e.createElement("style");h.type="text/css";e.getElementsByTagName("head")[0].appendChild(h);h[(typeof e.body.style.WebkitAppearance=="string")?"innerText":"innerHTML"]=g}};aj.fn.simpledraw=function(i,m,l,j){var g,h;if(l&&(g=this.data("_jqs_vcanvas"))){return g}if(aj.fn.sparkline.canvas===false){return false}else{if(aj.fn.sparkline.canvas===f){var k=e.createElement("canvas");if(!!(k.getContext&&k.getContext("2d"))){aj.fn.sparkline.canvas=function(o,q,n,p){return new ac(o,q,n,p)}}else{if(e.namespaces&&!e.namespaces.v){e.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML");aj.fn.sparkline.canvas=function(o,q,n,p){return new M(o,q,n)}}else{aj.fn.sparkline.canvas=false;return false}}}}if(i===f){i=aj(this).innerWidth()}if(m===f){m=aj(this).innerHeight()}g=aj.fn.sparkline.canvas(i,m,this,j);h=aj(this).data("_jqs_mhandler");if(h){h.registerCanvas(g)}return g};aj.fn.cleardraw=function(){var g=this.data("_jqs_vcanvas");if(g){g.reset()}};aj.RangeMapClass=X=R({init:function(g){var h,j,i=[];for(h in g){if(g.hasOwnProperty(h)&&typeof h==="string"&&h.indexOf(":")>-1){j=h.split(":");j[0]=j[0].length===0?-Infinity:parseFloat(j[0]);j[1]=j[1].length===0?Infinity:parseFloat(j[1]);j[2]=g[h];i.push(j)}}this.map=g;this.rangelist=i||false},get:function(g){var h=this.rangelist,i,j,k;if((k=this.map[g])!==f){return k}if(h){for(i=h.length;i--;){j=h[i];if(j[0]<=g&&j[1]>=g){return j[2]}}}return f}});aj.range_map=function(g){return new X(g)};S=R({init:function(g,i){var h=aj(g);this.$el=h;this.options=i;this.currentPageX=0;this.currentPageY=0;this.el=g;this.splist=[];this.tooltip=null;this.over=false;this.displayTooltips=!i.get("disableTooltips");this.highlightEnabled=!i.get("disableHighlight")},registerSparkline:function(g){this.splist.push(g);if(this.over){this.updateDisplay()}},registerCanvas:function(h){var g=aj(h.canvas);this.canvas=h;this.$canvas=g;g.mouseenter(aj.proxy(this.mouseenter,this));g.mouseleave(aj.proxy(this.mouseleave,this));g.click(aj.proxy(this.mouseclick,this))},reset:function(g){this.splist=[];if(this.tooltip&&g){this.tooltip.remove();this.tooltip=f}},mouseclick:function(g){var h=aj.Event("sparklineClick");h.originalEvent=g;h.sparklines=this.splist;this.$el.trigger(h)},mouseenter:function(g){aj(e.body).unbind("mousemove.jqs");aj(e.body).bind("mousemove.jqs",aj.proxy(this.mousemove,this));this.over=true;this.currentPageX=g.pageX;this.currentPageY=g.pageY;this.currentEl=g.target;if(!this.tooltip&&this.displayTooltips){this.tooltip=new ab(this.options);this.tooltip.updatePosition(g.pageX,g.pageY)}this.updateDisplay()},mouseleave:function(){aj(e.body).unbind("mousemove.jqs");var h=this.splist,k=h.length,i=false,g,j;this.over=false;this.currentEl=null;if(this.tooltip){this.tooltip.remove();this.tooltip=null}for(j=0;j<k;j++){g=h[j];if(g.clearRegionHighlight()){i=true}}if(i){this.canvas.render()}},mousemove:function(g){this.currentPageX=g.pageX;this.currentPageY=g.pageY;this.currentEl=g.target;if(this.tooltip){this.tooltip.updatePosition(g.pageX,g.pageY)}this.updateDisplay()},updateDisplay:function(){var p=this.splist,j=p.length,l=false,m=this.$canvas.offset(),n=this.currentPageX-m.left,o=this.currentPageY-m.top,i,q,k,g,h;if(!this.over){return}for(k=0;k<j;k++){q=p[k];g=q.setRegionHighlight(this.currentEl,n,o);if(g){l=true}}if(l){h=aj.Event("sparklineRegionChange");h.sparklines=this.splist;this.$el.trigger(h);if(this.tooltip){i="";for(k=0;k<j;k++){q=p[k];i+=q.getCurrentRegionTooltip()}this.tooltip.setContent(i)}if(!this.disableHighlight){this.canvas.render()}}if(g===null){this.mouseleave()}}});ab=R({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(j){var g=j.get("tooltipClassname","jqstooltip"),i=this.sizeStyle,h;this.container=j.get("tooltipContainer")||e.body;this.tooltipOffsetX=j.get("tooltipOffsetX",10);this.tooltipOffsetY=j.get("tooltipOffsetY",12);aj("#jqssizetip").remove();aj("#jqstooltip").remove();this.sizetip=aj("<div/>",{id:"jqssizetip",style:i,"class":g});this.tooltip=aj("<div/>",{id:"jqstooltip","class":g}).appendTo(this.container);h=this.tooltip.offset();this.offsetLeft=h.left;this.offsetTop=h.top;this.hidden=true;aj(window).unbind("resize.jqs scroll.jqs");aj(window).bind("resize.jqs scroll.jqs",aj.proxy(this.updateWindowDims,this));this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=aj(window).scrollTop();this.scrollLeft=aj(window).scrollLeft();this.scrollRight=this.scrollLeft+aj(window).width();this.updatePosition()},getSize:function(g){this.sizetip.html(g).appendTo(this.container);this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove()},setContent:function(g){if(!g){this.tooltip.css("visibility","hidden");this.hidden=true;return}this.getSize(g);this.tooltip.html(g).css({width:this.width,height:this.height,visibility:"visible"});if(this.hidden){this.hidden=false;this.updatePosition()}},updatePosition:function(h,g){if(h===f){if(this.mousex===f){return}h=this.mousex-this.offsetLeft;g=this.mousey-this.offsetTop}else{this.mousex=h=h-this.offsetLeft;this.mousey=g=g-this.offsetTop}if(!this.height||!this.width||this.hidden){return}g-=this.height+this.tooltipOffsetY;h+=this.tooltipOffsetX;if(g<this.scrollTop){g=this.scrollTop}if(h<this.scrollLeft){h=this.scrollLeft}else{if(h+this.width>this.scrollRight){h=this.scrollRight-this.width}}this.tooltip.css({left:h,top:g})},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=f;aj(window).unbind("resize.jqs scroll.jqs")}});aq=function(){c(a)};aj(aq);ak=[];aj.fn.sparkline=function(h,g){return this.each(function(){var l=new aj.fn.sparkline.options(this,g),i=aj(this),j,k;j=function(){var p,n,q,o,r,s,m;if(h==="html"||h===f){m=this.getAttribute(l.get("tagValuesAttribute"));if(m===f||m===null){m=i.html()}p=m.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")}else{p=h}n=l.get("width")==="auto"?p.length*l.get("defaultPixelsPerValue"):l.get("width");if(l.get("height")==="auto"){if(!l.get("composite")||!aj.data(this,"_jqs_vcanvas")){o=e.createElement("span");o.innerHTML="a";i.html(o);q=aj(o).innerHeight()||aj(o).height();aj(o).remove();o=null}}else{q=l.get("height")}if(!l.get("disableInteraction")){r=aj.data(this,"_jqs_mhandler");if(!r){r=new S(this,l);aj.data(this,"_jqs_mhandler",r)}else{if(!l.get("composite")){r.reset()}}}else{r=false}if(l.get("composite")&&!aj.data(this,"_jqs_vcanvas")){if(!aj.data(this,"_jqs_errnotify")){alert("Attempted to attach a composite sparkline to an element with no existing sparkline");aj.data(this,"_jqs_errnotify",true)}return}s=new aj.fn.sparkline[l.get("type")](this,p,l,n,q);s.render();if(r){r.registerSparkline(s)}};if((aj(this).html()&&!l.get("disableHiddenCheck")&&aj(this).is(":hidden"))||!aj(this).parents("body").length){if(!l.get("composite")&&aj.data(this,"_jqs_pending")){for(k=ak.length;k;k--){if(ak[k-1][0]==this){ak.splice(k-1,1)}}}ak.push([this,j]);aj.data(this,"_jqs_pending",true)}else{j.call(this)}})};aj.fn.sparkline.defaults=af();aj.sparkline_display_visible=function(){var g,i,h;var j=[];for(i=0,h=ak.length;i<h;i++){g=ak[i][0];if(aj(g).is(":visible")&&!aj(g).parents().is(":hidden")){ak[i][1].call(g);aj.data(ak[i][0],"_jqs_pending",false);j.push(i)}else{if(!aj(g).closest("html").length&&!aj.data(g,"_jqs_pending")){aj.data(ak[i][0],"_jqs_pending",false);j.push(i)}}}for(i=j.length;i;i--){ak.splice(j[i-1],1)}};aj.fn.sparkline.options=R({init:function(l,g){var h,i,j,k;this.userOptions=g=g||{};this.tag=l;this.tagValCache={};i=aj.fn.sparkline.defaults;j=i.common;this.tagOptionsPrefix=g.enableTagOptions&&(g.tagOptionsPrefix||j.tagOptionsPrefix);k=this.getTagSetting("type");if(k===Z){h=i[g.type||j.type]}else{h=i[k]}this.mergedOptions=aj.extend({},j,h,g)},getTagSetting:function(j){var h=this.tagOptionsPrefix,g,k,i,l;if(h===false||h===f){return Z}if(this.tagValCache.hasOwnProperty(j)){g=this.tagValCache.key}else{g=this.tag.getAttribute(h+j);if(g===f||g===null){g=Z}else{if(g.substr(0,1)==="["){g=g.substr(1,g.length-2).split(",");for(k=g.length;k--;){g[k]=ah(g[k].replace(/(^\s*)|(\s*$)/g,""))}}else{if(g.substr(0,1)==="{"){i=g.substr(1,g.length-2).split(",");g={};for(k=i.length;k--;){l=i[k].split(":",2);g[l[0].replace(/(^\s*)|(\s*$)/g,"")]=ah(l[1].replace(/(^\s*)|(\s*$)/g,""))}}else{g=ah(g)}}}this.tagValCache.key=g}return g},get:function(g,h){var i=this.getTagSetting(g),j;if(i!==Z){return i}return(j=this.mergedOptions[g])===f?h:j}});aj.fn.sparkline._base=R({disabled:false,init:function(g,j,i,h,k){this.el=g;this.$el=aj(g);this.values=j;this.options=i;this.width=h;this.height=k;this.currentRegion=f},initTarget:function(){var g=!this.options.get("disableInteraction");if(!(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),g))){this.disabled=true}else{this.canvasWidth=this.target.pixelWidth;this.canvasHeight=this.target.pixelHeight}},render:function(){if(this.disabled){this.el.innerHTML="";return false}return true},getRegion:function(h,g){},setRegionHighlight:function(j,l,g){var i=this.currentRegion,k=!this.options.get("disableHighlight"),h;if(l>this.canvasWidth||g>this.canvasHeight||l<0||g<0){return null}h=this.getRegion(j,l,g);if(i!==h){if(i!==f&&k){this.removeHighlight()}this.currentRegion=h;if(h!==f&&k){this.renderHighlight()}return true}return false},clearRegionHighlight:function(){if(this.currentRegion!==f){this.removeHighlight();this.currentRegion=f;return true}return false},renderHighlight:function(){this.changeHighlight(true)},removeHighlight:function(){this.changeHighlight(false)},changeHighlight:function(g){},getCurrentRegionTooltip:function(){var v=this.options,p="",o=[],n,i,u,l,w,q,m,r,k,s,g,h,j,t;if(this.currentRegion===f){return""}n=this.getCurrentRegionFields();g=v.get("tooltipFormatter");if(g){return g(this,v,n)}if(v.get("tooltipChartTitle")){p+='<div class="jqs jqstitle">'+v.get("tooltipChartTitle")+"</div>\n"}i=this.options.get("tooltipFormat");if(!i){return""}if(!aj.isArray(i)){i=[i]}if(!aj.isArray(n)){n=[n]}m=this.options.get("tooltipFormatFieldlist");r=this.options.get("tooltipFormatFieldlistKey");if(m&&r){k=[];for(q=n.length;q--;){s=n[q][r];if((t=aj.inArray(s,m))!=-1){k[t]=n[q]}}n=k}u=i.length;j=n.length;for(q=0;q<u;q++){h=i[q];if(typeof h==="string"){h=new V(h)}l=h.fclass||"jqsfield";for(t=0;t<j;t++){if(!n[t].isNull||!v.get("tooltipSkipNull")){aj.extend(n[t],{prefix:v.get("tooltipPrefix"),suffix:v.get("tooltipSuffix")});w=h.render(n[t],v.get("tooltipValueLookups"),v);o.push('<div class="'+l+'">'+w+"</div>")}}}if(o.length){return p+o.join("\n")}return""},getCurrentRegionFields:function(){},calcHighlightColor:function(n,m){var g=m.get("highlightColor"),k=m.get("highlightLighten"),h,i,j,l;if(g){return g}if(k){h=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(n)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(n);if(h){j=[];i=n.length===4?16:1;for(l=0;l<3;l++){j[l]=W(d.round(parseInt(h[l+1],16)*i*k),0,255)}return"rgb("+j.join(",")+")"}}return n}});al={changeHighlight:function(i){var g=this.currentRegion,h=this.target,k=this.regionShapes[g],j;if(k){j=this.renderRegion(g,i);if(aj.isArray(j)||aj.isArray(k)){h.replaceWithShapes(k,j);this.regionShapes[g]=aj.map(j,function(l){return l.id})}else{h.replaceWithShape(k,j);this.regionShapes[g]=j.id}}},render:function(){var l=this.values,h=this.target,g=this.regionShapes,m,i,j,k;if(!this.cls._super.render.call(this)){return}for(j=l.length;j--;){m=this.renderRegion(j);if(m){if(aj.isArray(m)){i=[];for(k=m.length;k--;){m[k].append();i.push(m[k].id)}g[j]=i}else{m.append();g[j]=m.id}}else{g[j]=null}}h.render()}};aj.fn.sparkline.line=aa=R(aj.fn.sparkline._base,{type:"line",init:function(g,j,i,h,k){aa._super.init.call(this,g,j,i,h,k);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null;this.lastShapeId=null;this.initTarget()},getRegion:function(i,k,g){var j,h=this.regionMap;for(j=h.length;j--;){if(h[j]!==null&&k>=h[j][0]&&k<=h[j][1]){return h[j][2]}}return f},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.yvalues[g]===null,x:this.xvalues[g],y:this.yvalues[g],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:g}},renderHighlight:function(){var o=this.currentRegion,h=this.target,k=this.vertices[o],g=this.options,l=g.get("spotRadius"),m=g.get("highlightSpotColor"),j=g.get("highlightLineColor"),n,i;if(!k){return}if(l&&m){n=h.drawCircle(k[0],k[1],l,f,m);this.highlightSpotId=n.id;h.insertAfterShape(this.lastShapeId,n)}if(j){i=h.drawLine(k[0],this.canvasTop,k[0],this.canvasTop+this.canvasHeight,j);this.highlightLineId=i.id;h.insertAfterShape(this.lastShapeId,i)}},removeHighlight:function(){var g=this.target;if(this.highlightSpotId){g.removeShapeId(this.highlightSpotId);this.highlightSpotId=null}if(this.highlightLineId){g.removeShapeId(this.highlightLineId);this.highlightLineId=null}},scanValues:function(){var h=this.values,n=h.length,p=this.xvalues,j=this.yvalues,g=this.yminmax,l,m,i,k,o;for(l=0;l<n;l++){m=h[l];i=typeof(h[l])==="string";k=typeof(h[l])==="object"&&h[l] instanceof Array;o=i&&h[l].split(":");if(i&&o.length===2){p.push(Number(o[0]));j.push(Number(o[1]));g.push(Number(o[1]))}else{if(k){p.push(m[0]);j.push(m[1]);g.push(m[1])}else{p.push(l);if(h[l]===null||h[l]==="null"){j.push(null)}else{j.push(Number(m));g.push(Number(m))}}}}if(this.options.get("xvalues")){p=this.options.get("xvalues")}this.maxy=this.maxyorg=d.max.apply(d,g);this.miny=this.minyorg=d.min.apply(d,g);this.maxx=d.max.apply(d,p);this.minx=d.min.apply(d,p);this.xvalues=p;this.yvalues=j;this.yminmax=g},processRangeOptions:function(){var h=this.options,i=h.get("normalRangeMin"),g=h.get("normalRangeMax");if(i!==f){if(i<this.miny){this.miny=i}if(g>this.maxy){this.maxy=g}}if(h.get("chartRangeMin")!==f&&(h.get("chartRangeClip")||h.get("chartRangeMin")<this.miny)){this.miny=h.get("chartRangeMin")}if(h.get("chartRangeMax")!==f&&(h.get("chartRangeClip")||h.get("chartRangeMax")>this.maxy)){this.maxy=h.get("chartRangeMax")}if(h.get("chartRangeMinX")!==f&&(h.get("chartRangeClipX")||h.get("chartRangeMinX")<this.minx)){this.minx=h.get("chartRangeMinX")}if(h.get("chartRangeMaxX")!==f&&(h.get("chartRangeClipX")||h.get("chartRangeMaxX")>this.maxx)){this.maxx=h.get("chartRangeMaxX")}},drawNormalRange:function(m,i,j,l,h){var o=this.options.get("normalRangeMin"),k=this.options.get("normalRangeMax"),n=i+d.round(j-(j*((k-this.miny)/h))),g=d.round((j*(k-o))/h);this.target.drawRect(m,n,l,g,f,this.options.get("normalRangeColor")).append()},render:function(){var n=this.options,v=this.target,y=this.canvasWidth,q=this.canvasHeight,k=this.vertices,u=n.get("spotRadius"),J=this.regionMap,r,s,E,A,C,z,I,F,L,g,G,p,x,h,H,w,o,m,K,t,j,D,i,l,B;if(!aa._super.render.call(this)){return}this.scanValues();this.processRangeOptions();i=this.xvalues;l=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2){return}A=C=0;r=this.maxx-this.minx===0?1:this.maxx-this.minx;s=this.maxy-this.miny===0?1:this.maxy-this.miny;E=this.yvalues.length-1;if(u&&(y<(u*4)||q<(u*4))){u=0}if(u){j=n.get("highlightSpotColor")&&!n.get("disableInteraction");if(j||n.get("minSpotColor")||(n.get("spotColor")&&l[E]===this.miny)){q-=d.ceil(u)}if(j||n.get("maxSpotColor")||(n.get("spotColor")&&l[E]===this.maxy)){q-=d.ceil(u);A+=d.ceil(u)}if(j||((n.get("minSpotColor")||n.get("maxSpotColor"))&&(l[0]===this.miny||l[0]===this.maxy))){C+=d.ceil(u);y-=d.ceil(u)}if(j||n.get("spotColor")||(n.get("minSpotColor")||n.get("maxSpotColor")&&(l[E]===this.miny||l[E]===this.maxy))){y-=d.ceil(u)}}q--;if(n.get("normalRangeMin")!==f&&!n.get("drawNormalOnTop")){this.drawNormalRange(C,A,q,y,s)}I=[];F=[I];h=H=null;w=l.length;for(B=0;B<w;B++){L=i[B];G=i[B+1];g=l[B];p=C+d.round((L-this.minx)*(y/r));x=B<w-1?C+d.round((G-this.minx)*(y/r)):y;H=p+((x-p)/2);J[B]=[h||0,H,B];h=H;if(g===null){if(B){if(l[B-1]!==null){I=[];F.push(I)}k.push(null)}}else{if(g<this.miny){g=this.miny}if(g>this.maxy){g=this.maxy}if(!I.length){I.push([p,A+q])}z=[p,A+d.round(q-(q*((g-this.miny)/s)))];I.push(z);k.push(z)}}o=[];m=[];K=F.length;for(B=0;B<K;B++){I=F[B];if(I.length){if(n.get("fillColor")){I.push([I[I.length-1][0],(A+q)]);m.push(I.slice(0));I.pop()}if(I.length>2){I[0]=[I[0][0],I[1][1]]}o.push(I)}}K=m.length;for(B=0;B<K;B++){v.drawShape(m[B],n.get("fillColor"),n.get("fillColor")).append()}if(n.get("normalRangeMin")!==f&&n.get("drawNormalOnTop")){this.drawNormalRange(C,A,q,y,s)}K=o.length;for(B=0;B<K;B++){v.drawShape(o[B],n.get("lineColor"),f,n.get("lineWidth")).append()}if(u&&n.get("valueSpots")){t=n.get("valueSpots");if(t.get===f){t=new X(t)}for(B=0;B<w;B++){D=t.get(l[B]);if(D){v.drawCircle(C+d.round((i[B]-this.minx)*(y/r)),A+d.round(q-(q*((l[B]-this.miny)/s))),u,f,D).append()}}}if(u&&n.get("spotColor")&&l[E]!==null){v.drawCircle(C+d.round((i[i.length-1]-this.minx)*(y/r)),A+d.round(q-(q*((l[E]-this.miny)/s))),u,f,n.get("spotColor")).append()}if(this.maxy!==this.minyorg){if(u&&n.get("minSpotColor")){L=i[aj.inArray(this.minyorg,l)];v.drawCircle(C+d.round((L-this.minx)*(y/r)),A+d.round(q-(q*((this.minyorg-this.miny)/s))),u,f,n.get("minSpotColor")).append()}if(u&&n.get("maxSpotColor")){L=i[aj.inArray(this.maxyorg,l)];v.drawCircle(C+d.round((L-this.minx)*(y/r)),A+d.round(q-(q*((this.maxyorg-this.miny)/s))),u,f,n.get("maxSpotColor")).append()}}this.lastShapeId=v.getLastShapeId();this.canvasTop=A;v.render()}});aj.fn.sparkline.bar=Y=R(aj.fn.sparkline._base,al,{type:"bar",init:function(p,m,ax,D,B){var av=parseInt(ax.get("barWidth"),10),at=parseInt(ax.get("barSpacing"),10),s=ax.get("chartRangeMin"),H=ax.get("chartRangeMax"),x=ax.get("chartRangeClip"),C=Infinity,k=-Infinity,j,q,F,aw,G,r,E,t,K,h,n,g,u,i,A,v,w,J,o,au,z,y,I;Y._super.init.call(this,p,m,ax,D,B);for(r=0,E=m.length;r<E;r++){au=m[r];j=typeof(au)==="string"&&au.indexOf(":")>-1;if(j||aj.isArray(au)){A=true;if(j){au=m[r]=O(au.split(":"))}au=N(au,null);q=d.min.apply(d,au);F=d.max.apply(d,au);if(q<C){C=q}if(F>k){k=F}}}this.stacked=A;this.regionShapes={};this.barWidth=av;this.barSpacing=at;this.totalBarWidth=av+at;this.width=D=(m.length*av)+((m.length-1)*at);this.initTarget();if(x){u=s===f?-Infinity:s;i=H===f?Infinity:H}G=[];aw=A?[]:G;var L=[];var l=[];for(r=0,E=m.length;r<E;r++){if(A){v=m[r];m[r]=o=[];L[r]=0;aw[r]=l[r]=0;for(w=0,J=v.length;w<J;w++){au=o[w]=x?W(v[w],u,i):v[w];if(au!==null){if(au>0){L[r]+=au}if(C<0&&k>0){if(au<0){l[r]+=d.abs(au)}else{aw[r]+=au}}else{aw[r]+=d.abs(au-(au<0?k:C))}G.push(au)}}}else{au=x?W(m[r],u,i):m[r];au=m[r]=ah(au);if(au!==null){G.push(au)}}}this.max=g=d.max.apply(d,G);this.min=n=d.min.apply(d,G);this.stackMax=k=A?d.max.apply(d,L):g;this.stackMin=C=A?d.min.apply(d,G):n;if(ax.get("chartRangeMin")!==f&&(ax.get("chartRangeClip")||ax.get("chartRangeMin")<n)){n=ax.get("chartRangeMin")}if(ax.get("chartRangeMax")!==f&&(ax.get("chartRangeClip")||ax.get("chartRangeMax")>g)){g=ax.get("chartRangeMax")}this.zeroAxis=K=ax.get("zeroAxis",true);if(n<=0&&g>=0&&K){h=0}else{if(K==false){h=n}else{if(n>0){h=n}else{h=g}}}this.xaxisOffset=h;t=A?(d.max.apply(d,aw)+d.max.apply(d,l)):g-n;this.canvasHeightEf=(K&&n<0)?this.canvasHeight-2:this.canvasHeight-1;if(n<h){y=(A&&g>=0)?k:g;z=(y-h)/t*this.canvasHeight;if(z!==d.ceil(z)){this.canvasHeightEf-=2;z=d.ceil(z)}}else{z=this.canvasHeight}this.yoffset=z;if(aj.isArray(ax.get("colorMap"))){this.colorMapByIndex=ax.get("colorMap");this.colorMapByValue=null}else{this.colorMapByIndex=null;this.colorMapByValue=ax.get("colorMap");if(this.colorMapByValue&&this.colorMapByValue.get===f){this.colorMapByValue=new X(this.colorMapByValue)}}this.range=t},getRegion:function(h,i,g){var j=d.floor(i/this.totalBarWidth);return(j<0||j>=this.values.length)?f:j},getCurrentRegionFields:function(){var g=this.currentRegion,j=ae(this.values[g]),k=[],h,i;for(i=j.length;i--;){h=j[i];k.push({isNull:h===null,value:h,color:this.calcColor(i,h,g),offset:g})}return k},calcColor:function(j,i,h){var g=this.colorMapByIndex,k=this.colorMapByValue,l=this.options,n,m;if(this.stacked){n=l.get("stackedBarColor")}else{n=(i<0)?l.get("negBarColor"):l.get("barColor")}if(i===0&&l.get("zeroColor")!==f){n=l.get("zeroColor")}if(k&&(m=k.get(i))){n=m}else{if(g&&g.length>h){n=g[h]}}return aj.isArray(n)?n[j%n.length]:n},renderRegion:function(j,p){var h=this.values[j],r=this.options,t=this.xaxisOffset,l=[],g=this.range,w=this.stacked,v=this.target,m=j*this.totalBarWidth,s=this.canvasHeightEf,k=this.yoffset,n,B,z,A,o,y,q,u,x,i;h=aj.isArray(h)?h:[h];q=h.length;u=h[0];A=ap(null,h);i=ap(t,h,true);if(A){if(r.get("nullColor")){z=p?r.get("nullColor"):this.calcHighlightColor(r.get("nullColor"),r);n=(k>0)?k-1:k;return v.drawRect(m,n,this.barWidth-1,0,z,z)}else{return f}}o=k;for(y=0;y<q;y++){u=h[y];if(w&&u===t){if(!i||x){continue}x=true}if(g>0){B=d.floor(s*((d.abs(u-t)/g)))+1}else{B=1}if(u<t||(u===t&&k===0)){n=o;o+=B}else{n=k-B;k-=B}z=this.calcColor(y,u,j);if(p){z=this.calcHighlightColor(z,r)}l.push(v.drawRect(m,n,this.barWidth-1,B-1,z,z))}if(l.length===1){return l[0]}return l}});aj.fn.sparkline.tristate=an=R(aj.fn.sparkline._base,al,{type:"tristate",init:function(h,l,k,i,m){var j=parseInt(k.get("barWidth"),10),g=parseInt(k.get("barSpacing"),10);an._super.init.call(this,h,l,k,i,m);this.regionShapes={};this.barWidth=j;this.barSpacing=g;this.totalBarWidth=j+g;this.values=aj.map(l,Number);this.width=i=(l.length*j)+((l.length-1)*g);if(aj.isArray(k.get("colorMap"))){this.colorMapByIndex=k.get("colorMap");this.colorMapByValue=null}else{this.colorMapByIndex=null;this.colorMapByValue=k.get("colorMap");if(this.colorMapByValue&&this.colorMapByValue.get===f){this.colorMapByValue=new X(this.colorMapByValue)}}this.initTarget()},getRegion:function(h,i,g){return d.floor(i/this.totalBarWidth)},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],color:this.calcColor(this.values[g],g),offset:g}},calcColor:function(i,h){var m=this.values,j=this.options,g=this.colorMapByIndex,k=this.colorMapByValue,n,l;if(k&&(l=k.get(i))){n=l}else{if(g&&g.length>h){n=g[h]}else{if(m[h]<0){n=j.get("negBarColor")}else{if(m[h]>0){n=j.get("posBarColor")}else{n=j.get("zeroBarColor")}}}}return n},renderRegion:function(n,q){var i=this.values,g=this.options,m=this.target,o,h,l,j,k,p;o=m.pixelHeight;l=d.round(o/2);j=n*this.totalBarWidth;if(i[n]<0){k=l;h=l-1}else{if(i[n]>0){k=0;h=l-1}else{k=l-1;h=2}}p=this.calcColor(i[n],n);if(p===null){return}if(q){p=this.calcHighlightColor(p,g)}return m.drawRect(j,k,this.barWidth-1,h-1,p,p)}});aj.fn.sparkline.discrete=ar=R(aj.fn.sparkline._base,al,{type:"discrete",init:function(g,j,i,h,k){ar._super.init.call(this,g,j,i,h,k);this.regionShapes={};this.values=j=aj.map(j,Number);this.min=d.min.apply(d,j);this.max=d.max.apply(d,j);this.range=this.max-this.min;this.width=h=i.get("width")==="auto"?j.length*2:this.width;this.interval=d.floor(h/j.length);this.itemWidth=h/j.length;if(i.get("chartRangeMin")!==f&&(i.get("chartRangeClip")||i.get("chartRangeMin")<this.min)){this.min=i.get("chartRangeMin")}if(i.get("chartRangeMax")!==f&&(i.get("chartRangeClip")||i.get("chartRangeMax")>this.max)){this.max=i.get("chartRangeMax")}this.initTarget();if(this.target){this.lineHeight=i.get("lineHeight")==="auto"?d.round(this.canvasHeight*0.3):i.get("lineHeight")}},getRegion:function(h,i,g){return d.floor(i/this.itemWidth)},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],offset:g}},renderRegion:function(m,r){var g=this.values,v=this.options,p=this.min,j=this.max,n=this.range,t=this.interval,k=this.target,o=this.canvasHeight,h=this.lineHeight,l=o-h,u,s,q,i;s=W(g[m],p,j);i=m*t;u=d.round(l-l*((s-p)/n));q=(v.get("thresholdColor")&&s<v.get("thresholdValue"))?v.get("thresholdColor"):v.get("lineColor");if(r){q=this.calcHighlightColor(q,v)}return k.drawLine(i,u,i,u+h,q)}});aj.fn.sparkline.bullet=U=R(aj.fn.sparkline._base,{type:"bullet",init:function(h,l,k,i,m){var j,n,g;U._super.init.call(this,h,l,k,i,m);this.values=l=O(l);g=l.slice();g[0]=g[0]===null?g[2]:g[0];g[1]=l[1]===null?g[2]:g[1];j=d.min.apply(d,l);n=d.max.apply(d,l);if(k.get("base")===f){j=j<0?j:0}else{j=k.get("base")}this.min=j;this.max=n;this.range=n-j;this.shapes={};this.valueShapes={};this.regiondata={};this.width=i=k.get("width")==="auto"?"4.0em":i;this.target=this.$el.simpledraw(i,m,k.get("composite"));if(!l.length){this.disabled=true}this.initTarget()},getRegion:function(i,j,g){var h=this.target.getShapeAt(i,j,g);return(h!==f&&this.shapes[h]!==f)?this.shapes[h]:f},getCurrentRegionFields:function(){var g=this.currentRegion;return{fieldkey:g.substr(0,1),value:this.values[g.substr(1)],region:g}},changeHighlight:function(i){var g=this.currentRegion,h=this.valueShapes[g],j;delete this.shapes[h];switch(g.substr(0,1)){case"r":j=this.renderRange(g.substr(1),i);break;case"p":j=this.renderPerformance(i);break;case"t":j=this.renderTarget(i);break}this.valueShapes[g]=j.id;this.shapes[j.id]=g;this.target.replaceWithShape(h,j)},renderRange:function(h,j){var g=this.values[h],i=d.round(this.canvasWidth*((g-this.min)/this.range)),k=this.options.get("rangeColors")[h-2];if(j){k=this.calcHighlightColor(k,this.options)}return this.target.drawRect(0,0,i-1,this.canvasHeight-1,k,k)},renderPerformance:function(i){var g=this.values[1],h=d.round(this.canvasWidth*((g-this.min)/this.range)),j=this.options.get("performanceColor");if(i){j=this.calcHighlightColor(j,this.options)}return this.target.drawRect(0,d.round(this.canvasHeight*0.3),h-1,d.round(this.canvasHeight*0.4)-1,j,j)},renderTarget:function(j){var g=this.values[0],l=d.round(this.canvasWidth*((g-this.min)/this.range)-(this.options.get("targetWidth")/2)),h=d.round(this.canvasHeight*0.1),i=this.canvasHeight-(h*2),k=this.options.get("targetColor");if(j){k=this.calcHighlightColor(k,this.options)}return this.target.drawRect(l,h,this.options.get("targetWidth")-1,i-1,k,k)},render:function(){var g=this.values.length,h=this.target,i,j;if(!U._super.render.call(this)){return}for(i=2;i<g;i++){j=this.renderRange(i).append();this.shapes[j.id]="r"+i;this.valueShapes["r"+i]=j.id}if(this.values[1]!==null){j=this.renderPerformance().append();this.shapes[j.id]="p1";this.valueShapes.p1=j.id}if(this.values[0]!==null){j=this.renderTarget().append();this.shapes[j.id]="t0";this.valueShapes.t0=j.id}h.render()}});aj.fn.sparkline.pie=Q=R(aj.fn.sparkline._base,{type:"pie",init:function(h,l,k,i,m){var g=0,j;Q._super.init.call(this,h,l,k,i,m);this.shapes={};this.valueShapes={};this.values=l=aj.map(l,Number);if(k.get("width")==="auto"){this.width=this.height}if(l.length>0){for(j=l.length;j--;){g+=l[j]}}this.total=g;this.initTarget();this.radius=d.floor(d.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(i,j,g){var h=this.target.getShapeAt(i,j,g);return(h!==f&&this.shapes[h]!==f)?this.shapes[h]:f},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],percent:this.values[g]/this.total*100,color:this.options.get("sliceColors")[g%this.options.get("sliceColors").length],offset:g}},changeHighlight:function(j){var g=this.currentRegion,i=this.renderSlice(g,j),h=this.valueShapes[g];delete this.shapes[h];this.target.replaceWithShape(h,i);this.valueShapes[g]=i.id;this.shapes[i.id]=g},renderSlice:function(l,r){var j=this.target,v=this.options,k=this.radius,u=v.get("borderWidth"),o=v.get("offset"),t=2*d.PI,g=this.values,i=this.total,m=o?(2*d.PI)*(o/360):0,s,p,n,h,q;h=g.length;for(n=0;n<h;n++){s=m;p=m;if(i>0){p=m+(t*(g[n]/i))}if(l===n){q=v.get("sliceColors")[n%v.get("sliceColors").length];if(r){q=this.calcHighlightColor(q,v)}return j.drawPieSlice(k,k,k-u,s,p,f,q)}m=p}},render:function(){var g=this.target,j=this.values,i=this.options,m=this.radius,k=i.get("borderWidth"),l,h;if(!Q._super.render.call(this)){return}if(k){g.drawCircle(m,m,d.floor(m-(k/2)),i.get("borderColor"),f,k).append()}for(h=j.length;h--;){if(j[h]){l=this.renderSlice(h).append();this.valueShapes[h]=l.id;this.shapes[l.id]=h}}g.render()}});aj.fn.sparkline.box=ad=R(aj.fn.sparkline._base,{type:"box",init:function(g,j,i,h,k){ad._super.init.call(this,g,j,i,h,k);this.values=aj.map(j,Number);this.width=i.get("width")==="auto"?"4.0em":h;this.initTarget();if(!this.values.length){this.disabled=1}},getRegion:function(){return 1},getCurrentRegionFields:function(){var g=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];if(this.loutlier!==f){g.push({field:"lo",value:this.loutlier})}if(this.routlier!==f){g.push({field:"ro",value:this.routlier})}if(this.lwhisker!==f){g.push({field:"lw",value:this.lwhisker})}if(this.rwhisker!==f){g.push({field:"rw",value:this.rwhisker})}return g},render:function(){var u=this.target,q=this.values,m=q.length,o=this.options,v=this.canvasWidth,s=this.canvasHeight,h=o.get("chartRangeMin")===f?d.min.apply(d,q):o.get("chartRangeMin"),w=o.get("chartRangeMax")===f?d.max.apply(d,q):o.get("chartRangeMax"),z=0,i,x,p,j,k,l,t,n,y,g,r;if(!ad._super.render.call(this)){return}if(o.get("raw")){if(o.get("showOutliers")&&q.length>5){x=q[0];i=q[1];j=q[2];k=q[3];l=q[4];t=q[5];n=q[6]}else{i=q[0];j=q[1];k=q[2];l=q[3];t=q[4]}}else{q.sort(function(A,B){return A-B});j=T(q,1);k=T(q,2);l=T(q,3);p=l-j;if(o.get("showOutliers")){i=t=f;for(y=0;y<m;y++){if(i===f&&q[y]>j-(p*o.get("outlierIQR"))){i=q[y]}if(q[y]<l+(p*o.get("outlierIQR"))){t=q[y]}}x=q[0];n=q[m-1]}else{i=q[0];t=q[m-1]}}this.quartiles=[j,k,l];this.lwhisker=i;this.rwhisker=t;this.loutlier=x;this.routlier=n;r=v/(w-h+1);if(o.get("showOutliers")){z=d.ceil(o.get("spotRadius"));v-=2*d.ceil(o.get("spotRadius"));r=v/(w-h+1);if(x<i){u.drawCircle((x-h)*r+z,s/2,o.get("spotRadius"),o.get("outlierLineColor"),o.get("outlierFillColor")).append()}if(n>t){u.drawCircle((n-h)*r+z,s/2,o.get("spotRadius"),o.get("outlierLineColor"),o.get("outlierFillColor")).append()}}u.drawRect(d.round((j-h)*r+z),d.round(s*0.1),d.round((l-j)*r),d.round(s*0.8),o.get("boxLineColor"),o.get("boxFillColor")).append();u.drawLine(d.round((i-h)*r+z),d.round(s/2),d.round((j-h)*r+z),d.round(s/2),o.get("lineColor")).append();u.drawLine(d.round((i-h)*r+z),d.round(s/4),d.round((i-h)*r+z),d.round(s-s/4),o.get("whiskerColor")).append();u.drawLine(d.round((t-h)*r+z),d.round(s/2),d.round((l-h)*r+z),d.round(s/2),o.get("lineColor")).append();u.drawLine(d.round((t-h)*r+z),d.round(s/4),d.round((t-h)*r+z),d.round(s-s/4),o.get("whiskerColor")).append();u.drawLine(d.round((k-h)*r+z),d.round(s*0.1),d.round((k-h)*r+z),d.round(s*0.9),o.get("medianColor")).append();if(o.get("target")){g=d.ceil(o.get("spotRadius"));u.drawLine(d.round((o.get("target")-h)*r+z),d.round((s/2)-g),d.round((o.get("target")-h)*r+z),d.round((s/2)+g),o.get("targetColor")).append();u.drawLine(d.round((o.get("target")-h)*r+z-g),d.round(s/2),d.round((o.get("target")-h)*r+z+g),d.round(s/2),o.get("targetColor")).append()}u.render()}});b=R({init:function(h,g,i,j){this.target=h;this.id=g;this.type=i;this.args=j},append:function(){this.target.appendShape(this);return this}});ai=R({_pxregex:/(\d+)(px)?\s*$/i,init:function(h,i,g){if(!h){return}this.width=h;this.height=i;this.target=g;this.lastShapeId=null;if(g[0]){g=g[0]}aj.data(g,"_jqs_vcanvas",this)},drawLine:function(j,h,k,i,g,l){return this.drawShape([[j,h],[k,i]],g,l)},drawShape:function(h,i,g,j){return this._genShape("Shape",[h,i,g,j])},drawCircle:function(j,g,k,i,h,l){return this._genShape("Circle",[j,g,k,i,h,l])},drawPieSlice:function(l,g,m,j,k,i,h){return this._genShape("PieSlice",[l,g,m,j,k,i,h])},drawRect:function(k,g,j,l,i,h){return this._genShape("Rect",[k,g,j,l,i,h])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(h,g){aj(g).html(h)},_calculatePixelDims:function(g,j,h){var i;i=this._pxregex.exec(j);if(i){this.pixelHeight=i[1]}else{this.pixelHeight=aj(h).height()}i=this._pxregex.exec(g);if(i){this.pixelWidth=i[1]}else{this.pixelWidth=aj(h).width()}},_genShape:function(h,i){var g=am++;i.unshift(g);return new b(this,g,h,i)},appendShape:function(g){alert("appendShape not implemented")},replaceWithShape:function(g,h){alert("replaceWithShape not implemented")},insertAfterShape:function(g,h){alert("insertAfterShape not implemented")},removeShapeId:function(g){alert("removeShapeId not implemented")},getShapeAt:function(h,i,g){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}});ac=R(ai,{init:function(h,j,g,i){ac._super.init.call(this,h,j,g);this.canvas=e.createElement("canvas");if(g[0]){g=g[0]}aj.data(g,"_jqs_vcanvas",this);aj(this.canvas).css({display:"inline-block",width:h,height:j,verticalAlign:"top"});this._insert(this.canvas,g);this._calculatePixelDims(h,j,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.interact=i;this.shapes={};this.shapeseq=[];this.currentTargetShapeId=f;aj(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(h,g,j){var i=this.canvas.getContext("2d");if(h!==f){i.strokeStyle=h}i.lineWidth=j===f?1:j;if(g!==f){i.fillStyle=g}return i},reset:function(){var g=this._getContext();g.clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=f},_drawShape:function(h,i,j,g,n){var l=this._getContext(j,g,n),m,k;l.beginPath();l.moveTo(i[0][0]+0.5,i[0][1]+0.5);for(m=1,k=i.length;m<k;m++){l.lineTo(i[m][0]+0.5,i[m][1]+0.5)}if(j!==f){l.stroke()}if(g!==f){l.fill()}if(this.targetX!==f&&this.targetY!==f&&l.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=h}},_drawCircle:function(i,l,g,m,j,h,n){var k=this._getContext(j,h,n);k.beginPath();k.arc(l,g,m,0,2*d.PI,false);if(this.targetX!==f&&this.targetY!==f&&k.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=i}if(j!==f){k.stroke()}if(h!==f){k.fill()}},_drawPieSlice:function(k,g,i,l,j,m,h,n){var o=this._getContext(h,n);o.beginPath();o.moveTo(g,i);o.arc(g,i,l,j,m,false);o.lineTo(g,i);o.closePath();if(h!==f){o.stroke()}if(n){o.fill()}if(this.targetX!==f&&this.targetY!==f&&o.isPointInPath(this.targetX,this.targetY)){this.currentTargetShapeId=k}},_drawRect:function(i,l,g,k,m,j,h){return this._drawShape(i,[[l,g],[l+k,g],[l+k,g+m],[l,g+m],[l,g]],j,h)},appendShape:function(g){this.shapes[g.id]=g;this.shapeseq.push(g.id);this.lastShapeId=g.id;return g.id},replaceWithShape:function(h,j){var g=this.shapeseq,i;this.shapes[j.id]=j;for(i=g.length;i--;){if(g[i]==h){g[i]=j.id}}delete this.shapes[h]},replaceWithShapes:function(k,l){var g=this.shapeseq,i={},m,j,h;for(j=k.length;j--;){i[k[j]]=true}for(j=g.length;j--;){m=g[j];if(i[m]){g.splice(j,1);delete this.shapes[m];h=j}}for(j=l.length;j--;){g.splice(h,0,l[j].id);this.shapes[l[j].id]=l[j]}},insertAfterShape:function(h,j){var g=this.shapeseq,i;for(i=g.length;i--;){if(g[i]===h){g.splice(i+1,0,j.id);this.shapes[j.id]=j;return}}},removeShapeId:function(h){var g=this.shapeseq,i;for(i=g.length;i--;){if(g[i]===h){g.splice(i,1);break}}delete this.shapes[h]},getShapeAt:function(h,i,g){this.targetX=i;this.targetY=g;this.render();return this.currentTargetShapeId},render:function(){var g=this.shapeseq,m=this.shapes,i=g.length,j=this._getContext(),h,l,k;j.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(k=0;k<i;k++){h=g[k];l=m[h];this["_draw"+l.type].apply(this,l.args)}if(!this.interact){this.shapes={};this.shapeseq=[]}}});M=R(ai,{init:function(i,j,g){var h;M._super.init.call(this,i,j,g);if(g[0]){g=g[0]}aj.data(g,"_jqs_vcanvas",this);this.canvas=e.createElement("span");aj(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:i,height:j,margin:"0px",padding:"0px",verticalAlign:"top"});this._insert(this.canvas,g);this._calculatePixelDims(i,j,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;h='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>';this.canvas.insertAdjacentHTML("beforeEnd",h);this.group=aj(this.canvas).children()[0];this.rendered=false;this.prerender=""},_drawShape:function(n,g,l,s,p){var k=[],m,h,i,o,j,r,q;for(q=0,r=g.length;q<r;q++){k[q]=""+(g[q][0])+","+(g[q][1])}m=k.splice(0,1);p=p===f?1:p;h=l===f?' stroked="false" ':' strokeWeight="'+p+'px" strokeColor="'+l+'" ';i=s===f?' filled="false"':' fillColor="'+s+'" filled="true" ';o=k[0]===k[k.length-1]?"x ":"";j='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+n+'" '+h+i+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+m+" l "+k.join(", ")+" "+o+'e"> </v:shape>';return j},_drawCircle:function(m,j,l,n,k,p,o){var g,h,i;j-=n;l-=n;g=k===f?' stroked="false" ':' strokeWeight="'+o+'px" strokeColor="'+k+'" ';h=p===f?' filled="false"':' fillColor="'+p+'" filled="true" ';i='<v:oval  id="jqsshape'+m+'" '+g+h+' style="position:absolute;top:'+l+"px; left:"+j+"px; width:"+(n*2)+"px; height:"+(n*2)+'px"></v:oval>';return i},_drawPieSlice:function(n,i,k,o,m,r,j,s){var l,t,u,p,q,v,g,h;if(m===r){return""}if((r-m)===(2*d.PI)){m=0;r=(2*d.PI)}t=i+d.round(d.cos(m)*o);u=k+d.round(d.sin(m)*o);p=i+d.round(d.cos(r)*o);q=k+d.round(d.sin(r)*o);if(t===p&&u===q){if((r-m)<d.PI){return""}t=p=i+o;u=q=k}if(t===p&&u===q&&(r-m)<d.PI){return""}l=[i-o,k-o,i+o,k+o,t,u,p,q];v=j===f?' stroked="false" ':' strokeWeight="1px" strokeColor="'+j+'" ';g=s===f?' filled="false"':' fillColor="'+s+'" filled="true" ';h='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+n+'" '+v+g+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+i+","+k+" wa "+l.join(", ")+' x e"> </v:shape>';return h},_drawRect:function(i,l,g,k,m,j,h){return this._drawShape(i,[[l,g],[l,g+m],[l+k,g+m],[l+k,g],[l,g]],j,h)},reset:function(){this.group.innerHTML=""},appendShape:function(h){var g=this["_draw"+h.type].apply(this,h.args);if(this.rendered){this.group.insertAdjacentHTML("beforeEnd",g)}else{this.prerender+=g}this.lastShapeId=h.id;return h.id},replaceWithShape:function(g,j){var h=aj("#jqsshape"+g),i=this["_draw"+j.type].apply(this,j.args);h[0].outerHTML=i},replaceWithShapes:function(k,l){var h=aj("#jqsshape"+k[0]),i="",g=l.length,j;for(j=0;j<g;j++){i+=this["_draw"+l[j].type].apply(this,l[j].args)}h[0].outerHTML=i;for(j=1;j<k.length;j++){aj("#jqsshape"+k[j]).remove()}},insertAfterShape:function(g,j){var h=aj("#jqsshape"+g),i=this["_draw"+j.type].apply(this,j.args);h[0].insertAdjacentHTML("afterEnd",i)},removeShapeId:function(g){var h=aj("#jqsshape"+g);this.group.removeChild(h[0])},getShapeAt:function(i,j,g){var h=i.id.substr(8);return h},render:function(){if(!this.rendered){this.group.innerHTML=this.prerender;this.rendered=true}}})}))}(document,Math));