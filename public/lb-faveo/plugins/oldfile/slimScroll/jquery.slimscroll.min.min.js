/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.3
 *
 */
(function(b){b.fn.extend({slimScroll:function(a){var f={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:"#333",railOpacity:0.2,railDraggable:true,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:false,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"};var e=b.extend(f,a);this.each(function(){var D,J,S,N,M,H,O,T,R="<div></div>",G=30,L=false;var K=b(this);if(K.parent().hasClass(e.wrapperClass)){var V=K.scrollTop();F=K.parent().find("."+e.barClass);Y=K.parent().find("."+e.railClass);I();if(b.isPlainObject(a)){if("height" in a&&a.height=="auto"){K.parent().css("height","auto");K.css("height","auto");var P=K.parent().parent().height();K.parent().css("height",P);K.css("height",P)}if("scrollTo" in a){V=parseInt(e.scrollTo)}else{if("scrollBy" in a){V+=parseInt(e.scrollBy)}else{if("destroy" in a){F.remove();Y.remove();K.unwrap();return}}}E(V,false,true)}return}else{if(b.isPlainObject(a)){if("destroy" in a){return}}}e.height=(e.height=="auto")?K.parent().height():e.height;var U=b(R).addClass(e.wrapperClass).css({position:"relative",overflow:"hidden",width:e.width,height:e.height});K.css({overflow:"hidden",width:e.width,height:e.height});var Y=b(R).addClass(e.railClass).css({width:e.size,height:"100%",position:"absolute",top:0,display:(e.alwaysVisible&&e.railVisible)?"block":"none","border-radius":e.railBorderRadius,background:e.railColor,opacity:e.railOpacity,zIndex:90});var F=b(R).addClass(e.barClass).css({background:e.color,width:e.size,position:"absolute",top:0,opacity:e.opacity,display:e.alwaysVisible?"block":"none","border-radius":e.borderRadius,BorderRadius:e.borderRadius,MozBorderRadius:e.borderRadius,WebkitBorderRadius:e.borderRadius,zIndex:99});var X=(e.position=="right")?{right:e.distance}:{left:e.distance};Y.css(X);F.css(X);K.wrap(U);K.parent().append(F);K.parent().append(Y);if(e.railDraggable){F.bind("mousedown",function(h){var g=b(document);S=true;t=parseFloat(F.css("top"));pageY=h.pageY;g.bind("mousemove.slimscroll",function(i){currTop=t+i.pageY-pageY;F.css("top",currTop);E(0,F.position().top,false)});g.bind("mouseup.slimscroll",function(i){S=false;Q();g.unbind(".slimscroll")});return false}).bind("selectstart.slimscroll",function(g){g.stopPropagation();g.preventDefault();return false})}Y.hover(function(){W()},function(){Q()});F.hover(function(){J=true},function(){J=false});K.hover(function(){D=true;W();Q()},function(){D=false;Q()});K.bind("touchstart",function(g,h){if(g.originalEvent.touches.length){M=g.originalEvent.touches[0].pageY}});K.bind("touchmove",function(g){if(!L){g.originalEvent.preventDefault()}if(g.originalEvent.touches.length){var h=(M-g.originalEvent.touches[0].pageY)/e.touchScrollStep;E(h,true);M=g.originalEvent.touches[0].pageY}});I();if(e.start==="bottom"){F.css({top:K.outerHeight()-F.outerHeight()});E(0,true)}else{if(e.start!=="top"){E(b(e.start).position().top,null,true);if(!e.alwaysVisible){F.hide()}}}d();function c(h){if(!D){return}var h=h||window.event;var g=0;if(h.wheelDelta){g=-h.wheelDelta/120}if(h.detail){g=h.detail/3}var i=h.target||h.srcTarget||h.srcElement;if(b(i).closest("."+e.wrapperClass).is(K.parent())){E(g,true)}if(h.preventDefault&&!L){h.preventDefault()}if(!L){h.returnValue=false}}function E(g,j,l){L=false;var h=g;var i=K.outerHeight()-F.outerHeight();if(j){h=parseInt(F.css("top"))+g*parseInt(e.wheelStep)/100*F.outerHeight();h=Math.min(Math.max(h,0),i);h=(g>0)?Math.ceil(h):Math.floor(h);F.css({top:h+"px"})}O=parseInt(F.css("top"))/(K.outerHeight()-F.outerHeight());h=O*(K[0].scrollHeight-K.outerHeight());if(l){h=g;var k=h/K[0].scrollHeight*K.outerHeight();k=Math.min(Math.max(k,0),i);F.css({top:k+"px"})}K.scrollTop(h);K.trigger("slimscrolling",~~h);W();Q()}function d(){if(window.addEventListener){this.addEventListener("DOMMouseScroll",c,false);this.addEventListener("mousewheel",c,false)}else{document.attachEvent("onmousewheel",c)}}function I(){H=Math.max((K.outerHeight()/K[0].scrollHeight)*K.outerHeight(),G);F.css({height:H+"px"});var g=H==K.outerHeight()?"none":"block";F.css({display:g})}function W(){I();clearTimeout(N);if(O==~~O){L=e.allowPageScroll;if(T!=O){var g=(~~O==0)?"top":"bottom";K.trigger("slimscroll",g)}}else{L=false}T=O;if(H>=K.outerHeight()){L=true;return}F.stop(true,true).fadeIn("fast");if(e.railVisible){Y.stop(true,true).fadeIn("fast")}}function Q(){if(!e.alwaysVisible){N=setTimeout(function(){if(!(e.disableFadeOut&&D)&&!J&&!S){F.fadeOut("slow");Y.fadeOut("slow")}},1000)}}});return this}});b.fn.extend({slimscroll:b.fn.slimScroll})})(jQuery);